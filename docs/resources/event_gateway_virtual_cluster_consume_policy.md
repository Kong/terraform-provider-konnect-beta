---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "konnect_event_gateway_virtual_cluster_consume_policy Resource - terraform-provider-konnect-beta"
subcategory: ""
description: |-
  EventGatewayVirtualClusterConsumePolicy Resource
---

# konnect_event_gateway_virtual_cluster_consume_policy (Resource)

EventGatewayVirtualClusterConsumePolicy Resource

## Example Usage

```terraform
resource "konnect_event_gateway_virtual_cluster_consume_policy" "my_eventgatewayvirtualclusterconsumepolicy" {
  provider = konnect-beta
  decrypt = {
    condition = "context.topic.name.endsWith('my_suffix')"
    config = {
      decrypt = [
        {
          part_of_record = "key"
        }
      ]
      failure_mode = "error"
      key_sources = [
        {
          aws = {
            # ...
          }
        }
      ]
    }
    description = "...my_description..."
    enabled     = false
    labels = {
      key = "value"
    }
    name = "...my_name..."
  }
  gateway_id = "9524ec7d-36d9-465d-a8c5-83a3c9390458"
  modify_headers = {
    condition = "context.topic.name.endsWith('my_suffix')"
    config = {
      actions = [
        {
          remove = {
            key = "...my_key..."
          }
        }
      ]
    }
    description = "...my_description..."
    enabled     = false
    labels = {
      key = "value"
    }
    name = "...my_name..."
  }
  parent_policy_id = "8df180ce-a71e-4f3c-8749-4f35ff3ab10d"
  schema_validation = {
    condition = "context.topic.name.endsWith('my_suffix')"
    config = {
      key_validation_action = "skip"
      schema_registry = {
        schema_registry_reference_by_id = {
          id = "7671d8af-bc5a-4d37-9234-171178b1a48d"
        }
      }
      type                    = "json"
      value_validation_action = "skip"
    }
    description = "...my_description..."
    enabled     = true
    labels = {
      key = "value"
    }
    name = "...my_name..."
  }
  skip_record = {
    condition   = "context.topic.name.endsWith('my_suffix')"
    description = "...my_description..."
    enabled     = false
    labels = {
      key = "value"
    }
    name = "...my_name..."
  }
  virtual_cluster_id = "47a96a37-fce2-44e7-966b-b0c02a478a0f"
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `gateway_id` (String) The UUID of your Gateway.
- `virtual_cluster_id` (String) The ID of the Virtual Cluster.

### Optional

- `decrypt` (Attributes) Decrypts portions of Kafka records using AES_128_GCM. Keys are therefore 128 bits long. (see [below for nested schema](#nestedatt--decrypt))
- `modify_headers` (Attributes) A policy that modifies headers for requests. (see [below for nested schema](#nestedatt--modify_headers))
- `parent_policy_id` (String) When specified, it sets the ID of the parent policy. Requires replacement if changed.
- `schema_validation` (Attributes) A policy that validates consume messages against a schema registry. (see [below for nested schema](#nestedatt--schema_validation))
- `skip_record` (Attributes) A policy that skips processing of a record. (see [below for nested schema](#nestedatt--skip_record))

### Read-Only

- `condition` (String) A string containing the boolean expression that determines whether the policy is applied.
- `config` (Attributes) The configuration of the policy. (see [below for nested schema](#nestedatt--config))
- `created_at` (String) An ISO-8601 timestamp representation of entity creation date.
- `description` (String) A human-readable description of the policy.
- `enabled` (Boolean) Whether the policy is enabled. Default: true
- `id` (String) The unique identifier of the policy.
- `labels` (Map of String) Labels store metadata of an entity that can be used for filtering an entity list or for searching across entity types. 

Keys must be of length 1-63 characters, and cannot start with "kong", "konnect", "mesh", "kic", or "_".
- `name` (String) A unique user-defined name of the policy.
- `type` (String) The type name of the policy.
- `updated_at` (String) An ISO-8601 timestamp representation of entity update date.

<a id="nestedatt--decrypt"></a>
### Nested Schema for `decrypt`

Required:

- `config` (Attributes) The configuration of the decrypt policy. (see [below for nested schema](#nestedatt--decrypt--config))

Optional:

- `condition` (String) A string containing the boolean expression that determines whether the policy is applied.
- `description` (String) A human-readable description of the policy.
- `enabled` (Boolean) Whether the policy is enabled. Default: true
- `labels` (Map of String) Labels store metadata of an entity that can be used for filtering an entity list or for searching across entity types. 

Keys must be of length 1-63 characters, and cannot start with "kong", "konnect", "mesh", "kic", or "_".
- `name` (String) A unique user-defined name of the policy.

<a id="nestedatt--decrypt--config"></a>
### Nested Schema for `decrypt.config`

Required:

- `decrypt` (Attributes List) Describes what parts of a record to decrypt. (see [below for nested schema](#nestedatt--decrypt--config--decrypt))
- `failure_mode` (String) Describes how to handle failing encryption or decryption.
Use `error` if the record should be rejected if encryption or decryption fails.
Use `passthrough` to ignore encryption or decryption failure and continue proxying the record.
must be one of ["error", "passthrough"]
- `key_sources` (Attributes List) Describes how to find a symmetric key for decryption. (see [below for nested schema](#nestedatt--decrypt--config--key_sources))

<a id="nestedatt--decrypt--config--decrypt"></a>
### Nested Schema for `decrypt.config.decrypt`

Required:

- `part_of_record` (String) * key - decrypt the record key
* value - decrypt the record value
must be one of ["key", "value"]


<a id="nestedatt--decrypt--config--key_sources"></a>
### Nested Schema for `decrypt.config.key_sources`

Optional:

- `aws` (Attributes) A key source that uses an AWS KMS to find a symmetric key. Load KMS credentials from the environment.

See [aws docs](https://docs.aws.amazon.com/sdk-for-rust/latest/dg/credproviders.html#credproviders-default-credentials-provider-chain)
for more information about how credential retrieval. (see [below for nested schema](#nestedatt--decrypt--config--key_sources--aws))
- `static` (Attributes) A key source that uses a static symmetric key. The key is provided as a base64-encoded string. (see [below for nested schema](#nestedatt--decrypt--config--key_sources--static))

<a id="nestedatt--decrypt--config--key_sources--aws"></a>
### Nested Schema for `decrypt.config.key_sources.aws`


<a id="nestedatt--decrypt--config--key_sources--static"></a>
### Nested Schema for `decrypt.config.key_sources.static`

Required:

- `keys` (Attributes List) A list of static, user-provided keys. Each one must be 128 bits long. (see [below for nested schema](#nestedatt--decrypt--config--key_sources--static--keys))

<a id="nestedatt--decrypt--config--key_sources--static--keys"></a>
### Nested Schema for `decrypt.config.key_sources.static.keys`

Required:

- `id` (String) The unique identifier of the key.
- `key` (String) A sensitive value containing the secret or a reference to a secret as a template string expression.
If the value is provided as plain text, it is encrypted at rest and omitted from API responses.
If provided as an expression, the expression itself is stored and returned by the API.






<a id="nestedatt--modify_headers"></a>
### Nested Schema for `modify_headers`

Required:

- `config` (Attributes) The configuration of the modify headers policy. (see [below for nested schema](#nestedatt--modify_headers--config))

Optional:

- `condition` (String) A string containing the boolean expression that determines whether the policy is applied.

When the policy is applied as a child policy of schema_validation, the expression can also reference
`record.value` fields.
- `description` (String) A human-readable description of the policy.
- `enabled` (Boolean) Whether the policy is enabled. Default: true
- `labels` (Map of String) Labels store metadata of an entity that can be used for filtering an entity list or for searching across entity types. 

Keys must be of length 1-63 characters, and cannot start with "kong", "konnect", "mesh", "kic", or "_".
- `name` (String) A unique user-defined name of the policy.

<a id="nestedatt--modify_headers--config"></a>
### Nested Schema for `modify_headers.config`

Optional:

- `actions` (Attributes List) Actions are run in sequential order and act on individual headers. (see [below for nested schema](#nestedatt--modify_headers--config--actions))

<a id="nestedatt--modify_headers--config--actions"></a>
### Nested Schema for `modify_headers.config.actions`

Optional:

- `remove` (Attributes) An action that removes a header by key. (see [below for nested schema](#nestedatt--modify_headers--config--actions--remove))
- `set` (Attributes) An action that sets a header key and value. (see [below for nested schema](#nestedatt--modify_headers--config--actions--set))

<a id="nestedatt--modify_headers--config--actions--remove"></a>
### Nested Schema for `modify_headers.config.actions.remove`

Required:

- `key` (String) The key of the header to remove.


<a id="nestedatt--modify_headers--config--actions--set"></a>
### Nested Schema for `modify_headers.config.actions.set`

Required:

- `key` (String) The key of the header to set.
- `value` (String) The value of the header to set.





<a id="nestedatt--schema_validation"></a>
### Nested Schema for `schema_validation`

Optional:

- `condition` (String) A string containing the boolean expression that determines whether the policy is applied.
- `config` (Attributes) The configuration of the schema validation policy. (see [below for nested schema](#nestedatt--schema_validation--config))
- `description` (String) A human-readable description of the policy.
- `enabled` (Boolean) Whether the policy is enabled. Default: true
- `labels` (Map of String) Labels store metadata of an entity that can be used for filtering an entity list or for searching across entity types. 

Keys must be of length 1-63 characters, and cannot start with "kong", "konnect", "mesh", "kic", or "_".
- `name` (String) A unique user-defined name of the policy.

<a id="nestedatt--schema_validation--config"></a>
### Nested Schema for `schema_validation.config`

Required:

- `type` (String) How to validate the schema and parse the record.
* confluent_schema_registry - validates against confluent schema registry.
* json - simple JSON parsing without the schema.
must be one of ["confluent_schema_registry", "json"]

Optional:

- `key_validation_action` (String) Defines a behavior when record key is not valid.
* mark - marks a record with kong/server header and client ID value
  to help to identify the clients violating schema.
* skip - skips delivering a record.
must be one of ["mark", "skip"]
- `schema_registry` (Attributes) A reference to a schema Registry. (see [below for nested schema](#nestedatt--schema_validation--config--schema_registry))
- `value_validation_action` (String) Defines a behavior when record value is not valid.
* mark - marks a record with kong/server header and client ID value
  to help to identify the clients violating schema.
* skip - skips delivering a record.
must be one of ["mark", "skip"]

<a id="nestedatt--schema_validation--config--schema_registry"></a>
### Nested Schema for `schema_validation.config.schema_registry`

Optional:

- `schema_registry_reference_by_id` (Attributes) (see [below for nested schema](#nestedatt--schema_validation--config--schema_registry--schema_registry_reference_by_id))
- `schema_registry_reference_by_name` (Attributes) Reference a schema registry by its unique name. (see [below for nested schema](#nestedatt--schema_validation--config--schema_registry--schema_registry_reference_by_name))

<a id="nestedatt--schema_validation--config--schema_registry--schema_registry_reference_by_id"></a>
### Nested Schema for `schema_validation.config.schema_registry.schema_registry_reference_by_id`

Required:

- `id` (String) The unique identifier of the schema registry.


<a id="nestedatt--schema_validation--config--schema_registry--schema_registry_reference_by_name"></a>
### Nested Schema for `schema_validation.config.schema_registry.schema_registry_reference_by_name`

Required:

- `name` (String) The unique name of the schema registry.





<a id="nestedatt--skip_record"></a>
### Nested Schema for `skip_record`

Optional:

- `condition` (String) A string containing the boolean expression that determines whether the policy is applied.

When the policy is applied as a child policy of schema_validation, the expression can also reference
`record.value` fields.
- `description` (String) A human-readable description of the policy.
- `enabled` (Boolean) Whether the policy is enabled. Default: true
- `labels` (Map of String) Labels store metadata of an entity that can be used for filtering an entity list or for searching across entity types. 

Keys must be of length 1-63 characters, and cannot start with "kong", "konnect", "mesh", "kic", or "_".
- `name` (String) A unique user-defined name of the policy.


<a id="nestedatt--config"></a>
### Nested Schema for `config`

## Import

Import is supported using the following syntax:

```shell
terraform import konnect_event_gateway_virtual_cluster_consume_policy.my_konnect_event_gateway_virtual_cluster_consume_policy '{"gateway_id": "9524ec7d-36d9-465d-a8c5-83a3c9390458", "id": "9524ec7d-36d9-465d-a8c5-83a3c9390458", "virtual_cluster_id": ""}'
```
