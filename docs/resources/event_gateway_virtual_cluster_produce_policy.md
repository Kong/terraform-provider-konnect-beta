---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "konnect_event_gateway_virtual_cluster_produce_policy Resource - terraform-provider-konnect-beta"
subcategory: ""
description: |-
  EventGatewayVirtualClusterProducePolicy Resource
---

# konnect_event_gateway_virtual_cluster_produce_policy (Resource)

EventGatewayVirtualClusterProducePolicy Resource

## Example Usage

```terraform
resource "konnect_event_gateway_virtual_cluster_produce_policy" "my_eventgatewayvirtualclusterproducepolicy" {
  provider = konnect-beta
encrypt = {
    condition = "context.topic.name.endsWith('my_suffix')"
    config = {
            encrypt = [
        {
                        key_id = "static://static-key-named-in-source"
                part_of_record = "value"
        }
        ]
        failure_mode = "passthrough"
        key_sources = [
        {
        static = {
    keys = [
    {
                id = "...my_id..."
            key = "${vault.env['MY_ENV_VAR']}"
    }
    ]
}
        }
        ]
    }
    description = "...my_description..."
    enabled = false
    labels = {
        key = "value"
    }
    name = "...my_name..."
}
    gateway_id = "9524ec7d-36d9-465d-a8c5-83a3c9390458"
modify_headers = {
    condition = "context.topic.name.endsWith('my_suffix')"
    config = {
            actions = [
        {
        remove = {
    key = "...my_key..."
}
        }
        ]
    }
    description = "...my_description..."
    enabled = true
    labels = {
        key = "value"
    }
    name = "...my_name..."
}
    parent_policy_id = "ce933254-b3f6-41d7-adfc-3db1ba8b90ca"
schema_validation = {
    condition = "context.topic.name.endsWith('my_suffix')"
    config = {
        # ...
    }
    description = "...my_description..."
    enabled = true
    labels = {
        key = "value"
    }
    name = "...my_name..."
}
skip_record = {
    condition = "context.topic.name.endsWith('my_suffix')"
    description = "...my_description..."
    enabled = true
    labels = {
        key = "value"
    }
    name = "...my_name..."
}
    virtual_cluster_id = "aacd895d-537a-41aa-baf6-3c8a82b63a74"
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `gateway_id` (String) The UUID of your Gateway.
- `virtual_cluster_id` (String) The ID of the Virtual Cluster.

### Optional

- `encrypt` (Attributes) Encrypts portions of Kafka records using AES_128_GCM. Keys are therefore 128 bits long. (see [below for nested schema](#nestedatt--encrypt))
- `modify_headers` (Attributes) A policy that modifies headers for requests. (see [below for nested schema](#nestedatt--modify_headers))
- `parent_policy_id` (String) When specified, it sets the ID of the parent policy. Requires replacement if changed.
- `schema_validation` (Attributes) A policy that validates produce messages against a schema registry. (see [below for nested schema](#nestedatt--schema_validation))
- `skip_record` (Attributes) A policy that skips processing of a record. (see [below for nested schema](#nestedatt--skip_record))

### Read-Only

- `condition` (String) A string containing the boolean expression that determines whether the policy is applied.
- `config` (Attributes) The configuration of the policy. (see [below for nested schema](#nestedatt--config))
- `created_at` (String) An ISO-8601 timestamp representation of entity creation date.
- `description` (String) A human-readable description of the policy.
- `enabled` (Boolean) Whether the policy is enabled. Default: true
- `id` (String) The unique identifier of the policy.
- `labels` (Map of String) Labels store metadata of an entity that can be used for filtering an entity list or for searching across entity types. 

Keys must be of length 1-63 characters, and cannot start with "kong", "konnect", "mesh", "kic", or "_".
- `name` (String) A unique user-defined name of the policy.
- `type` (String) The type name of the policy.
- `updated_at` (String) An ISO-8601 timestamp representation of entity update date.

<a id="nestedatt--encrypt"></a>
### Nested Schema for `encrypt`

Required:

- `config` (Attributes) The configuration of the encrypt policy. (see [below for nested schema](#nestedatt--encrypt--config))

Optional:

- `condition` (String) A string containing the boolean expression that determines whether the policy is applied.
- `description` (String) A human-readable description of the policy.
- `enabled` (Boolean) Whether the policy is enabled. Default: true
- `labels` (Map of String) Labels store metadata of an entity that can be used for filtering an entity list or for searching across entity types. 

Keys must be of length 1-63 characters, and cannot start with "kong", "konnect", "mesh", "kic", or "_".
- `name` (String) A unique user-defined name of the policy.

<a id="nestedatt--encrypt--config"></a>
### Nested Schema for `encrypt.config`

Required:

- `encrypt` (Attributes List) Describes what parts of a record to encrypt. (see [below for nested schema](#nestedatt--encrypt--config--encrypt))
- `failure_mode` (String) Describes how to handle failing encryption or decryption.
Use `error` if the record should be rejected if encryption or decryption fails.
Use `passthrough` to ignore encryption or decryption failure and continue proxying the record.
must be one of ["error", "passthrough"]
- `key_sources` (Attributes List) Describes how to find a symmetric key for encryption. (see [below for nested schema](#nestedatt--encrypt--config--key_sources))

<a id="nestedatt--encrypt--config--encrypt"></a>
### Nested Schema for `encrypt.config.encrypt`

Required:

- `key_id` (String) The id of the key to use for encryption. It must match one of the keys defined in the policy's key_sources.

An ID is a URI where the scheme refers to the type of key source and the rest is source-specific:
- static: the id defined in the list of static keys
- aws: a KMS key ARN
- `part_of_record` (String) * key - encrypt the record key
* value - encrypt the record value
must be one of ["key", "value"]


<a id="nestedatt--encrypt--config--key_sources"></a>
### Nested Schema for `encrypt.config.key_sources`

Optional:

- `aws` (Attributes) A key source that uses an AWS KMS to find a symmetric key. Load KMS credentials from the environment.

See [aws docs](https://docs.aws.amazon.com/sdk-for-rust/latest/dg/credproviders.html#credproviders-default-credentials-provider-chain)
for more information about how credential retrieval. (see [below for nested schema](#nestedatt--encrypt--config--key_sources--aws))
- `static` (Attributes) A key source that uses a static symmetric key. The key is provided as a base64-encoded string. (see [below for nested schema](#nestedatt--encrypt--config--key_sources--static))

<a id="nestedatt--encrypt--config--key_sources--aws"></a>
### Nested Schema for `encrypt.config.key_sources.aws`


<a id="nestedatt--encrypt--config--key_sources--static"></a>
### Nested Schema for `encrypt.config.key_sources.static`

Required:

- `keys` (Attributes List) A list of static, user-provided keys. Each one must be 128 bits long. (see [below for nested schema](#nestedatt--encrypt--config--key_sources--static--keys))

<a id="nestedatt--encrypt--config--key_sources--static--keys"></a>
### Nested Schema for `encrypt.config.key_sources.static.keys`

Required:

- `id` (String) The unique identifier of the key.

Optional:

- `key` (String) A sensitive value containing the secret or a reference to a secret as a template string expression.
If the value is provided as plain text, it is encrypted at rest and omitted from API responses.
If provided as an expression, the expression itself is stored and returned by the API.






<a id="nestedatt--modify_headers"></a>
### Nested Schema for `modify_headers`

Required:

- `config` (Attributes) The configuration of the modify headers policy. (see [below for nested schema](#nestedatt--modify_headers--config))

Optional:

- `condition` (String) A string containing the boolean expression that determines whether the policy is applied.

When the policy is applied as a child policy of schema_validation, the expression can also reference
`record.value` fields.
- `description` (String) A human-readable description of the policy.
- `enabled` (Boolean) Whether the policy is enabled. Default: true
- `labels` (Map of String) Labels store metadata of an entity that can be used for filtering an entity list or for searching across entity types. 

Keys must be of length 1-63 characters, and cannot start with "kong", "konnect", "mesh", "kic", or "_".
- `name` (String) A unique user-defined name of the policy.

<a id="nestedatt--modify_headers--config"></a>
### Nested Schema for `modify_headers.config`

Optional:

- `actions` (Attributes List) Actions are run in sequential order and act on individual headers. (see [below for nested schema](#nestedatt--modify_headers--config--actions))

<a id="nestedatt--modify_headers--config--actions"></a>
### Nested Schema for `modify_headers.config.actions`

Optional:

- `remove` (Attributes) An action that removes a header by key. (see [below for nested schema](#nestedatt--modify_headers--config--actions--remove))
- `set` (Attributes) An action that sets a header key and value. (see [below for nested schema](#nestedatt--modify_headers--config--actions--set))

<a id="nestedatt--modify_headers--config--actions--remove"></a>
### Nested Schema for `modify_headers.config.actions.remove`

Required:

- `key` (String) The key of the header to remove.


<a id="nestedatt--modify_headers--config--actions--set"></a>
### Nested Schema for `modify_headers.config.actions.set`

Required:

- `key` (String) The key of the header to set.
- `value` (String) The value of the header to set.





<a id="nestedatt--schema_validation"></a>
### Nested Schema for `schema_validation`

Required:

- `config` (Attributes) The configuration of the produce schema validation policy. (see [below for nested schema](#nestedatt--schema_validation--config))

Optional:

- `condition` (String) A string containing the boolean expression that determines whether the policy is applied.
- `description` (String) A human-readable description of the policy.
- `enabled` (Boolean) Whether the policy is enabled. Default: true
- `labels` (Map of String) Labels store metadata of an entity that can be used for filtering an entity list or for searching across entity types. 

Keys must be of length 1-63 characters, and cannot start with "kong", "konnect", "mesh", "kic", or "_".
- `name` (String) A unique user-defined name of the policy.

<a id="nestedatt--schema_validation--config"></a>
### Nested Schema for `schema_validation.config`

Optional:

- `confluent_schema_registry` (Attributes) The configuration of the produce schema validation policy when using a schema registry. (see [below for nested schema](#nestedatt--schema_validation--config--confluent_schema_registry))
- `json` (Attributes) The configuration of the produce schema validation policy when using JSON parsing without schema. (see [below for nested schema](#nestedatt--schema_validation--config--json))

<a id="nestedatt--schema_validation--config--confluent_schema_registry"></a>
### Nested Schema for `schema_validation.config.confluent_schema_registry`

Optional:

- `key_validation_action` (String) Defines a behavior when record key is not valid.
* reject - rejects a batch for topic partition. Only available for produce.
* mark - marks a record with kong/server header and client ID value

  to help to identify the clients violating schema.
must be one of ["reject", "mark"]
- `schema_registry` (Attributes) A reference to a schema Registry. (see [below for nested schema](#nestedatt--schema_validation--config--confluent_schema_registry--schema_registry))
- `value_validation_action` (String) Defines a behavior when record value is not valid.
* reject - rejects a batch for topic partition. Only available for produce.
* mark - marks a record with kong/server header and client ID value

  to help to identify the clients violating schema.
must be one of ["reject", "mark"]

<a id="nestedatt--schema_validation--config--confluent_schema_registry--schema_registry"></a>
### Nested Schema for `schema_validation.config.confluent_schema_registry.schema_registry`

Optional:

- `schema_registry_reference_by_id` (Attributes) (see [below for nested schema](#nestedatt--schema_validation--config--confluent_schema_registry--schema_registry--schema_registry_reference_by_id))
- `schema_registry_reference_by_name` (Attributes) Reference a schema registry by its unique name. (see [below for nested schema](#nestedatt--schema_validation--config--confluent_schema_registry--schema_registry--schema_registry_reference_by_name))

<a id="nestedatt--schema_validation--config--confluent_schema_registry--schema_registry--schema_registry_reference_by_id"></a>
### Nested Schema for `schema_validation.config.confluent_schema_registry.schema_registry.schema_registry_reference_by_id`

Required:

- `id` (String) The unique identifier of the schema registry.


<a id="nestedatt--schema_validation--config--confluent_schema_registry--schema_registry--schema_registry_reference_by_name"></a>
### Nested Schema for `schema_validation.config.confluent_schema_registry.schema_registry.schema_registry_reference_by_name`

Required:

- `name` (String) The unique name of the schema registry.




<a id="nestedatt--schema_validation--config--json"></a>
### Nested Schema for `schema_validation.config.json`

Optional:

- `key_validation_action` (String) Defines a behavior when record key is not valid.
* reject - rejects a batch for topic partition. Only available for produce.
* mark - marks a record with kong/server header and client ID value

  to help to identify the clients violating schema.
must be one of ["reject", "mark"]
- `schema_registry` (Attributes) A reference to a schema Registry. (see [below for nested schema](#nestedatt--schema_validation--config--json--schema_registry))
- `value_validation_action` (String) Defines a behavior when record value is not valid.
* reject - rejects a batch for topic partition. Only available for produce.
* mark - marks a record with kong/server header and client ID value

  to help to identify the clients violating schema.
must be one of ["reject", "mark"]

<a id="nestedatt--schema_validation--config--json--schema_registry"></a>
### Nested Schema for `schema_validation.config.json.schema_registry`

Optional:

- `schema_registry_reference_by_id` (Attributes) (see [below for nested schema](#nestedatt--schema_validation--config--json--schema_registry--schema_registry_reference_by_id))
- `schema_registry_reference_by_name` (Attributes) Reference a schema registry by its unique name. (see [below for nested schema](#nestedatt--schema_validation--config--json--schema_registry--schema_registry_reference_by_name))

<a id="nestedatt--schema_validation--config--json--schema_registry--schema_registry_reference_by_id"></a>
### Nested Schema for `schema_validation.config.json.schema_registry.schema_registry_reference_by_id`

Required:

- `id` (String) The unique identifier of the schema registry.


<a id="nestedatt--schema_validation--config--json--schema_registry--schema_registry_reference_by_name"></a>
### Nested Schema for `schema_validation.config.json.schema_registry.schema_registry_reference_by_name`

Required:

- `name` (String) The unique name of the schema registry.






<a id="nestedatt--skip_record"></a>
### Nested Schema for `skip_record`

Optional:

- `condition` (String) A string containing the boolean expression that determines whether the policy is applied.

When the policy is applied as a child policy of schema_validation, the expression can also reference
`record.value` fields.
- `description` (String) A human-readable description of the policy.
- `enabled` (Boolean) Whether the policy is enabled. Default: true
- `labels` (Map of String) Labels store metadata of an entity that can be used for filtering an entity list or for searching across entity types. 

Keys must be of length 1-63 characters, and cannot start with "kong", "konnect", "mesh", "kic", or "_".
- `name` (String) A unique user-defined name of the policy.


<a id="nestedatt--config"></a>
### Nested Schema for `config`

## Import

Import is supported using the following syntax:

```shell
terraform import konnect_event_gateway_virtual_cluster_produce_policy.my_konnect_event_gateway_virtual_cluster_produce_policy '{"gateway_id": "9524ec7d-36d9-465d-a8c5-83a3c9390458", "id": "9524ec7d-36d9-465d-a8c5-83a3c9390458", "virtual_cluster_id": ""}'
```
