---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "konnect_event_gateway_listener_policy Resource - terraform-provider-konnect-beta"
subcategory: ""
description: |-
  EventGatewayListenerPolicy Resource
---

# konnect_event_gateway_listener_policy (Resource)

EventGatewayListenerPolicy Resource

## Example Usage

```terraform
resource "konnect_event_gateway_listener_policy" "my_eventgatewaylistenerpolicy" {
  provider = konnect-beta
    event_gateway_listener_id = "48c9353f-7dda-464b-8fe4-e6972a3aeae2"
forward_to_virtual_cluster = {
    condition = "context.topic.name.endsWith('my_suffix')"
    config = {
    port_mapping = {
    advertised_host = "...my_advertised_host..."
    bootstrap_port = "none"
    destination = {
    virtual_cluster_reference_by_id = {
    id = "0cf1742b-423d-4928-be30-69ffe732f3fd"
}
    }
    min_broker_id = 5
}
    }
    description = "...my_description..."
    enabled = true
    labels = {
        key = "value"
    }
    name = "...my_name..."
}
    gateway_id = "9524ec7d-36d9-465d-a8c5-83a3c9390458"
tls_server = {
    condition = "context.topic.name.endsWith('my_suffix')"
    config = {
            allow_plaintext = false
        certificates = [
        {
                        certificate = "...my_certificate..."
                key = "${vault.env['MY_ENV_VAR']}"
        }
        ]
        versions = {
                    max = "TLSv1.2"
            min = "TLSv1.3"
        }
    }
    description = "...my_description..."
    enabled = true
    labels = {
        key = "value"
    }
    name = "...my_name..."
}
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `event_gateway_listener_id` (String) The ID of the Event Gateway Listener.
- `gateway_id` (String) The UUID of your Gateway.

### Optional

- `forward_to_virtual_cluster` (Attributes) Forwards requests to virtual clusters configured with port routing or SNI routing.
While there can be multiple of these policies configured on a listener, there can only be one instance of
`port_mapping`.
When multiple policies are configured, the first one that matches the connection is used.
If no policy matches, the connection is rejected.

When using `port_mapping`, there must be a mapping port for each broker on the backend cluster see
`ForwardToClusterBySNIConfig` for more details. (see [below for nested schema](#nestedatt--forward_to_virtual_cluster))
- `tls_server` (Attributes) The TLS Server policy defines the certificates and keys used by the gateway server when the client connects
to the gateway over TLS.

While it is possible to have multiple TLS policies on a listener, only one can be active at a time. (see [below for nested schema](#nestedatt--tls_server))

### Read-Only

- `condition` (String) A string containing the boolean expression that determines whether the policy is applied.
- `config` (Attributes) The configuration of the policy. (see [below for nested schema](#nestedatt--config))
- `created_at` (String) An ISO-8601 timestamp representation of entity creation date.
- `description` (String) A human-readable description of the policy.
- `enabled` (Boolean) Whether the policy is enabled. Default: true
- `id` (String) The unique identifier of the policy.
- `labels` (Map of String) Labels store metadata of an entity that can be used for filtering an entity list or for searching across entity types. 

Keys must be of length 1-63 characters, and cannot start with "kong", "konnect", "mesh", "kic", or "_".
- `name` (String) A unique user-defined name of the policy.
- `parent_policy_id` (String) The unique identifier of the parent policy, if any.
- `type` (String) The type name of the policy.
- `updated_at` (String) An ISO-8601 timestamp representation of entity update date.

<a id="nestedatt--forward_to_virtual_cluster"></a>
### Nested Schema for `forward_to_virtual_cluster`

Required:

- `config` (Attributes) (see [below for nested schema](#nestedatt--forward_to_virtual_cluster--config))

Optional:

- `condition` (String) A string containing the boolean expression that determines whether the policy is applied.
- `description` (String) A human-readable description of the policy.
- `enabled` (Boolean) Whether the policy is enabled. Default: true
- `labels` (Map of String) Labels store metadata of an entity that can be used for filtering an entity list or for searching across entity types. 

Keys must be of length 1-63 characters, and cannot start with "kong", "konnect", "mesh", "kic", or "_".
- `name` (String) A unique user-defined name of the policy.

<a id="nestedatt--forward_to_virtual_cluster--config"></a>
### Nested Schema for `forward_to_virtual_cluster.config`

Optional:

- `port_mapping` (Attributes) The configuration to forward request to `destination` and rewrite ports accordingly.
All broker ids must fit in the range of ports defined in the listener, if it doesn't the metadata request will
return an error.

For example with ports: [9000, "9092-9094", "9100"] and `bootstrap_port: at_start` and brokers with ids
1, 2, 3, 4 we will map: bootstrap to 9000 broker 1 to 9001, broker 2 to 9002, broker 3 to 9003, and broker 4
to 9004 and fail the metadata request as these ports are not open.

However, with the same configuration but with brokers with ids: 92,93,94,100 we will map: bootstrap to 9000,
broker 92 to 9092, broker 93 to 9093, broker 94 to 9094, and broker 100 to 9100.

In most cases users should use a single range `["9090-9094"] ` and `bootstrap_port: at_start` and connect with
`<host>:9090` as bootstrap server. Being able to use multiple ranges is only useful when when dealing with
gaps in broker ids.

It is strongly discouraged to use port mapping in production. (see [below for nested schema](#nestedatt--forward_to_virtual_cluster--config--port_mapping))
- `sni` (Attributes) The configuration to forward requests to virtual clusters configured with SNI routing. (see [below for nested schema](#nestedatt--forward_to_virtual_cluster--config--sni))

<a id="nestedatt--forward_to_virtual_cluster--config--port_mapping"></a>
### Nested Schema for `forward_to_virtual_cluster.config.port_mapping`

Required:

- `advertised_host` (String) Virtual brokers are advertised to clients using this host. Any kind of host supported by kafka can be used. If not defined, it's listen_address. If listen_address is `0.0.0.0` it's the destination IP of the TCP connection.
- `destination` (Attributes) A reference to a virtual cluster. (see [below for nested schema](#nestedatt--forward_to_virtual_cluster--config--port_mapping--destination))

Optional:

- `bootstrap_port` (String) If set to `at_start`, the first port will be used as a bootstrap port.
It provides a stable endpoint to use as the bootstrap server for clients, regardless of broker
IDs in the cluster.

Additionally, it offsets all ports by one, so for example, if there are 3 brokers (id=1, id=2, id=3)
then we will use 4 ports: 9092 (bootstrap), 9093 (id=1), 9094 (id=2), 9095 (id=3)
With `none` we will use 3 ports: 9092 (id=1), 9093 (id=2), 9094 (id=3).
Default: "at_start"; must be one of ["none", "at_start"]
- `min_broker_id` (Number) The lowest broker node ID in the cluster. Default: 0

<a id="nestedatt--forward_to_virtual_cluster--config--port_mapping--destination"></a>
### Nested Schema for `forward_to_virtual_cluster.config.port_mapping.destination`

Optional:

- `virtual_cluster_reference_by_id` (Attributes) Reference a virtual cluster by its unique identifier. (see [below for nested schema](#nestedatt--forward_to_virtual_cluster--config--port_mapping--destination--virtual_cluster_reference_by_id))
- `virtual_cluster_reference_by_name` (Attributes) Reference a virtual cluster by its unique name. (see [below for nested schema](#nestedatt--forward_to_virtual_cluster--config--port_mapping--destination--virtual_cluster_reference_by_name))

<a id="nestedatt--forward_to_virtual_cluster--config--port_mapping--destination--virtual_cluster_reference_by_id"></a>
### Nested Schema for `forward_to_virtual_cluster.config.port_mapping.destination.virtual_cluster_reference_by_id`

Required:

- `id` (String) The unique identifier of the virtual cluster.


<a id="nestedatt--forward_to_virtual_cluster--config--port_mapping--destination--virtual_cluster_reference_by_name"></a>
### Nested Schema for `forward_to_virtual_cluster.config.port_mapping.destination.virtual_cluster_reference_by_name`

Required:

- `name` (String) The name of the virtual cluster.




<a id="nestedatt--forward_to_virtual_cluster--config--sni"></a>
### Nested Schema for `forward_to_virtual_cluster.config.sni`

Optional:

- `advertised_port` (Number) Virtual brokers are advertised to clients with this port instead of listen_port. Useful when proxy is
behind loadbalancer listening on different port.
- `sni_suffix` (String) Optional suffix for TLS SNI validation.

This suffix is concatenated with the virtual cluster "dns.label" label to form the base name for the SNI.
If not provided, the virtual cluster "dns.label" label alone is used as the base name for the SNI.
For example with sni_suffix: `.example.com` and virtual cluster "dns.label" label: `my-cluster`,
the SNI suffix for it is `my-cluster.example.com`.
If "dns.label" label is absent on the virtual cluster, the traffic won't be routed there.

The bootstrap host is `bootstrap.my-cluster.example.com` and then each broker is addressable at `broker-0.my-cluster.example.com`, `broker-1.my-cluster.example.com`, etc.
This means that your deployment needs to have a wildcard certificate for the domain and a DNS resolver that routes `*.my-cluster.example.com` to the proxy.




<a id="nestedatt--tls_server"></a>
### Nested Schema for `tls_server`

Required:

- `config` (Attributes) (see [below for nested schema](#nestedatt--tls_server--config))

Optional:

- `condition` (String) A string containing the boolean expression that determines whether the policy is applied.
- `description` (String) A human-readable description of the policy.
- `enabled` (Boolean) Whether the policy is enabled. Default: true
- `labels` (Map of String) Labels store metadata of an entity that can be used for filtering an entity list or for searching across entity types. 

Keys must be of length 1-63 characters, and cannot start with "kong", "konnect", "mesh", "kic", or "_".
- `name` (String) A unique user-defined name of the policy.

<a id="nestedatt--tls_server--config"></a>
### Nested Schema for `tls_server.config`

Required:

- `certificates` (Attributes List) (see [below for nested schema](#nestedatt--tls_server--config--certificates))

Optional:

- `allow_plaintext` (Boolean) If false, only TLS connections are allowed. If true, both TLS and plaintext connections are allowed. Default: false
- `versions` (Attributes) A range of TLS versions. (see [below for nested schema](#nestedatt--tls_server--config--versions))

<a id="nestedatt--tls_server--config--certificates"></a>
### Nested Schema for `tls_server.config.certificates`

Required:

- `certificate` (String) A literal value or a reference to an existing secret as a template string expression.
The value is stored and returned by the API as-is, not treated as sensitive information.
- `key` (String) A sensitive value containing the secret or a reference to a secret as a template string expression.
If the value is provided as plain text, it is encrypted at rest and omitted from API responses.
If provided as an expression, the expression itself is stored and returned by the API.


<a id="nestedatt--tls_server--config--versions"></a>
### Nested Schema for `tls_server.config.versions`

Optional:

- `max` (String) Maximum TLS version to use. Default: "TLSv1.3"; must be one of ["TLSv1.2", "TLSv1.3"]
- `min` (String) Minimum TLS version to use. Default: "TLSv1.2"; must be one of ["TLSv1.2", "TLSv1.3"]




<a id="nestedatt--config"></a>
### Nested Schema for `config`

## Import

Import is supported using the following syntax:

```shell
terraform import konnect_event_gateway_listener_policy.my_konnect_event_gateway_listener_policy '{"event_gateway_listener_id": "", "gateway_id": "9524ec7d-36d9-465d-a8c5-83a3c9390458", "id": "9524ec7d-36d9-465d-a8c5-83a3c9390458"}'
```
